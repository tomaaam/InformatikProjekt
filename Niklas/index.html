<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helldivers Tastenkombinationen Ãœben</title>
    <style>
        /* Original styles */
        body {
            background-image: url('background2.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            color: white; /* Adjust text color for better visibility */
            margin: 0; /* Remove default margin */
        }
        #actionImage {
            width: 200px;
            height: 200px;
        }
        #arrow-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20vh;
        }
        .arrow {
            font-family: 'ui-sans-serif', sans-serif;
            font-size: 80px;
            margin: 0 20px;
        }
        .action-name {
            font-size: 40px;
            font-weight: bold;
            margin-top: -140px;
            text-align: center;
        }
        .green { color: green; }
        .red { color: red; }
        
        /* Dark mode */
        body.dark-mode {
            background-color: black;
        }

        /* Toggle button styles */
        .toggle-menu-button {
            position: absolute; /* Position the button absolutely */
            top: calc(50vh + 80px); /* Position below the two lines of text */
            left: 20px; /* Left position */
            z-index: 999;
        }

        /* Scrollable menu styles */
        .scrollable-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-height: 80%;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }
        .scrollable-menu h2 {
            color: white;
        }
        .action-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            color: white;
        }

        /* Checkbox styles */
        input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #007bff; /* Blue color */
            outline: none;
            cursor: pointer;
            position: relative;
        }
        input[type="checkbox"]:checked::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background-color: #007bff; /* Blue color */
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <h1>Train Support calls for Helldivers 2</h1>
    <p>Press the keys in the order shown</p>
    <button class="toggle-menu-button" onclick="toggleMenu()">Toggle Menu</button>
    <div id="scrollableMenu" class="scrollable-menu">
        <h2>Actions</h2>
        <!-- Action toggles will be added here -->
    </div>
    <div id="arrow-container"></div>

    <script>
        const aktionen = [
            { name: "SOS Beacon", sequence: "wsdw" },
            { name: "Resupply", sequence: "sswd" },
            { name: "Orbital 380mm HE Barrage", sequence: "dswwass" },
            { name: "Orbital 120mm HE Barrage", sequence: "ddsads" },
            { name: "Eagle Napalm Airstrike", sequence: "wdsw" },
            { name: "Orbital Precision Strike", sequence: "ddw" },
            { name: "Hellbomb", sequence: "swaswdsw" },
            { name: "Eagle Strafing Run", sequence: "wdd" },
            { name: "Eagle Cluster Bomb", sequence: "wdssd" },
            { name: "Eagle Airstrike", sequence: "wdsd" },
            { name: "Eagle 110mm Rocket Pods", sequence: "wdwa" },
        ];
        
        // Randomize the order of actions for testing
        aktionen.sort(() => Math.random() - 0.5);

        let aktuelleAktionIndex = 0;
        let aktuelleTastenIndex = 0;

        const arrowContainer = document.getElementById('arrow-container');
        const scrollableMenu = document.getElementById('scrollableMenu');

        let settings = JSON.parse(localStorage.getItem('helldivers_settings')) || {};

        function showAction() {
            let aktuelleAktion = getNextEnabledAction();

            // If there are no enabled actions, do nothing
            if (!aktuelleAktion) return;

            arrowContainer.innerHTML = ''; // Clear previous content
            const arrowContainerDiv = document.createElement('div');
            arrowContainerDiv.id = 'arrow-container';
            arrowContainerDiv.classList.add('arrow-container');

            const actionImage = document.createElement('img');
            actionImage.src = aktuelleAktion.name.toLowerCase().replace(/\s+/g, '-') + '.png';
            actionImage.alt = aktuelleAktion.name;
            actionImage.id = 'actionImage';
            arrowContainerDiv.appendChild(actionImage);

            const actionNameParagraph = document.createElement('p');
            actionNameParagraph.textContent = aktuelleAktion.name;
            actionNameParagraph.classList.add('action-name'); // Add action-name class for styling
            arrowContainerDiv.appendChild(actionNameParagraph);

            arrowContainer.appendChild(arrowContainerDiv);

            setArrowDirection(aktuelleAktion.sequence);
        }

        function getNextEnabledAction() {
            let nextIndex = aktuelleAktionIndex;
            let enabledActions = aktionen.filter(action => settings[action.name] !== false);
            if (enabledActions.length === 0) return null;
            do {
                nextIndex = (nextIndex + 1) % aktionen.length;
            } while (settings[aktionen[nextIndex].name] === false);
            aktuelleAktionIndex = nextIndex;
            return aktionen[nextIndex];
        }

        function setArrowDirection(sequence) {
            const arrowUnicodeMap = {
                'w': 'ðŸ ‰', // â–² (Thicker arrow)
                's': 'ðŸ ‹', // â–¼ (Thicker arrow)
                'a': 'ðŸ ˆ', // â—„ (Thicker arrow)
                'd': 'ðŸ Š'  // â–º (Thicker arrow)
            };

            sequence.split('').forEach(taste => {
                const arrowDiv = document.createElement('div');
                arrowDiv.classList.add('arrow');
                arrowDiv.innerHTML = arrowUnicodeMap[taste];
                arrowContainer.appendChild(arrowDiv);
            });
        }

        function checkKeyPress(event) {
            const aktuelleTaste = event.key.toLowerCase();
            const aktuelleAktion = aktionen[aktuelleAktionIndex];

            console.log('GedrÃ¼ckte Taste:', aktuelleTaste);

            if (aktuelleTaste === aktuelleAktion.sequence[aktuelleTastenIndex]) {
                // Wenn die richtige Taste gedrÃ¼ckt wird
                aktuelleTastenIndex++; // Zum nÃ¤chsten Tastenindex gehen
                console.log('Richtige Taste gedrÃ¼ckt');

                if (aktuelleTastenIndex === aktuelleAktion.sequence.length) {
                    // Wenn alle Tasten erfolgreich gedrÃ¼ckt wurden
                    aktuelleAktionIndex = (aktuelleAktionIndex + 1) % aktionen.length;
                    aktuelleTastenIndex = 0; // Reset Tastenindex fÃ¼r die nÃ¤chste Aktion
                    showAction();
                }
            } else {
                // Wenn eine falsche Taste gedrÃ¼ckt wird
                makeArrowsRed(aktuelleAktion.sequence);
                console.log('Falsche Taste gedrÃ¼ckt');
                aktuelleTastenIndex = 0; // Reset Tastenindex
            }

            updateArrowState();
        }

        function makeArrowsRed(sequence) {
            const arrows = arrowContainer.querySelectorAll('.arrow');
            arrows.forEach(arrow => {
                arrow.classList.remove('green');
                arrow.classList.add('red');
                setTimeout(() => {
                    arrow.classList.remove('red');
                }, 500);
            });
        }

        function updateArrowState() {
            const arrows = arrowContainer.querySelectorAll('.arrow');
            arrows.forEach((arrow, index) => {
                if (index < aktuelleTastenIndex) {
                    arrow.classList.add('green');
                } else {
                    arrow.classList.remove('green');
                }
            });
        }

        document.addEventListener('keydown', checkKeyPress);
        showAction();

        function toggleMenu() {
            scrollableMenu.style.display = scrollableMenu.style.display === 'none' ? 'block' : 'none';
        }

        // Function to create action toggles
        function createActionToggles() {
            aktionen.forEach(action => {
                const toggle = document.createElement('input');
                toggle.type = 'checkbox';
                toggle.id = action.name.replace(/\s+/g, '-');
                toggle.checked = settings[action.name] === undefined ? true : settings[action.name];
                toggle.addEventListener('change', () => {
                    settings[action.name] = toggle.checked;
                    localStorage.setItem('helldivers_settings', JSON.stringify(settings));
                    showAction();
                });

                const label = document.createElement('label');
                label.htmlFor = toggle.id;
                label.textContent = action.name;

                const actionToggle = document.createElement('div');
                actionToggle.classList.add('action-toggle');
                actionToggle.appendChild(toggle);
                actionToggle.appendChild(label);

                scrollableMenu.appendChild(actionToggle);
            });
        }

        // Sort actions alphabetically for selection menu
        aktionen.sort((a, b) => a.name.localeCompare(b.name));

        createActionToggles();

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
</body>
</html>
